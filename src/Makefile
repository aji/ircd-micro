.PHONY: version.c
PROG = ircd-micro
SRCS = numeric.c \
	auth.c \
	chan.c \
	conf.c \
	conn.c \
	cookie.c \
	crypto.c \
	hook.c \
	link.c \
	log.c \
	map.c \
	mode.c \
	module.c \
	msg.c \
	ratelimit.c \
	sendto.c \
	sendq.c \
	server.c \
	strop.c \
	upgrade.c \
	user.c \
	util.c \
	version.c \
	vsnf.c \
	main.c
DISTCLEAN = numeric.c numeric.h

build: all

include ../buildsys.mk
include ../extra.mk

CFLAGS += -Wall
CPPFLAGS += -I. -I../include
LDFLAGS += -rdynamic $(LDFLAGS_RPATH)

CFLAGS += $(MOWGLI_CFLAGS)
LIBS += $(MOWGLI_LIBS)

numeric.h numeric.c: numeric.tab
	@echo "Creating numeric.[ch]"
	awk -f numeric.awk < numeric.tab

version.c.dep:
	echo >version.c.dep

version.c:
	@echo "Creating version.c"
	if [ -f $@ ]; then mv $@ $@.last; fi
	echo '/* auto-generated by Makefile */' > $@
	echo '#include "ircd.h"' >> $@
	echo "char *version = PACKAGE_FULLNAME;" >> $@
	echo "char *date = \"`date -u +%F\ %H:%M\ UTC`\";" >> $@
	echo "char *platform = \"`uname -sm`\";" >> $@
	rev=`git log -1 --pretty=oneline | cut -c-10 2>/dev/null`; \
	echo "char *revision = \"$$rev\";" >> $@
